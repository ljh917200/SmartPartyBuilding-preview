import{h as de,r as f,G as re,D as me,V as j,W as fe,X as ge,Y as ve,c as R,a as n,w as a,b as c,o as D,g as u,f as w,s as Te,M as ye,k as L,p as be,t as $,B as r,z as F,_ as _e}from"./index-G-qDTFo-.js";const Ae={class:"container"},he={style:{"margin-bottom":"10px",display:"flex",gap:"10px"}},De={class:"table-wrapper"},xe={key:0,class:"icon-container"},Ce=["src"],we={key:1,class:"icon-placeholder"},ke=de({__name:"index",setup(Ve){const x=f([]),V=f(0),m=f(!1),y=f(1),b=f(10),C=f([]);re(()=>{v()});const v=async()=>{m.value=!0;try{const t=[{id:"43de40e1dfee6ec94941ce70f8d16634",number:"760731",title:"拆反正猛然哎哎呀索性关于发型加上",icon:"https://avatars.githubusercontent.com/u/85906775",content:"tjtnt",type:"1",points:2,releaseTime:null,status:2,updateTime:"2025-09-15 11:26:07"},{id:"55263b8d9138456ebd3d279e3db0db55",number:"967463",title:"拆反正猛然哎哎呀索性关于发型加上",icon:"https://avatars.githubusercontent.com/u/85906775",content:"tjtnt",type:"2",points:2,releaseTime:null,status:2,updateTime:"2025-09-15 09:51:26"},{id:"6270477908343df3f70d3e169250e10c",number:"172185",title:"尴尬的",icon:"https://avatars.githubusercontent.com/u/85906775",content:"sit et",type:"1",points:10,releaseTime:null,status:2,updateTime:"2025-09-15 09:50:43"},{id:"DATA_001",number:"DATA-2023001",title:"入党流程指南",icon:"icon1.png",content:"http://example.com/data1.pdf",type:"1",points:45,releaseTime:"2025-05-25 17:19:00",status:1,updateTime:"2025-05-25 17:19:00"},{id:"DATA_003",number:"DATA-2023003",title:"党章解读",icon:"icon3.png",content:"http://example.com/data1.pdf",type:"2",points:2,releaseTime:"2025-09-15 14:39:24",status:1,updateTime:"2025-09-15 14:39:24"},{id:"DATA_004",number:"DATA-2023004",title:"党员发展工作手册",icon:"icon4.png",content:"http://example.com/data4.pdf",type:"1",points:3,releaseTime:"2025-09-15 15:30:00",status:1,updateTime:"2025-09-15 15:30:00"},{id:"DATA_005",number:"DATA-2023005",title:"党的基本知识教育",icon:"icon5.png",content:"http://example.com/data5.pdf",type:"2",points:5,releaseTime:"2025-09-16 09:20:00",status:1,updateTime:"2025-09-16 09:20:00"},{id:"DATA_006",number:"DATA-2023006",title:"党性修养提升",icon:"icon6.png",content:"http://example.com/data6.pdf",type:"1",points:4,releaseTime:null,status:2,updateTime:"2025-09-16 10:15:00"},{id:"DATA_007",number:"DATA-2023007",title:"党风廉政建设",icon:"icon7.png",content:"http://example.com/data7.pdf",type:"2",points:6,releaseTime:"2025-09-16 14:40:00",status:1,updateTime:"2025-09-16 14:40:00"},{id:"DATA_008",number:"DATA-2023008",title:"党史学习教育",icon:"icon8.png",content:"http://example.com/data8.pdf",type:"1",points:7,releaseTime:null,status:2,updateTime:"2025-09-17 08:50:00"},{id:"DATA_009",number:"DATA-2023009",title:"党的组织工作条例",icon:"icon9.png",content:"http://example.com/data9.pdf",type:"2",points:8,releaseTime:"2025-09-17 11:30:00",status:1,updateTime:"2025-09-17 11:30:00"},{id:"DATA_010",number:"DATA-2023010",title:"党员权利保障条例",icon:"icon10.png",content:"http://example.com/data10.pdf",type:"1",points:5,releaseTime:"2025-09-17 16:20:00",status:1,updateTime:"2025-09-17 16:20:00"},{id:"DATA_011",number:"DATA-2023011",title:"党支部工作手册",icon:"icon11.png",content:"http://example.com/data11.pdf",type:"2",points:6,releaseTime:null,status:2,updateTime:"2025-09-18 09:10:00"},{id:"DATA_012",number:"DATA-2023012",title:"党的群众路线教育",icon:"icon12.png",content:"http://example.com/data12.pdf",type:"1",points:9,releaseTime:"2025-09-18 13:45:00",status:1,updateTime:"2025-09-18 13:45:00"},{id:"DATA_013",number:"DATA-2023013",title:"党员先锋模范作用",icon:"icon13.png",content:"http://example.com/data13.pdf",type:"2",points:7,releaseTime:null,status:2,updateTime:"2025-09-18 15:20:00"}],e=(y.value-1)*b.value,i=e+b.value,p=t.slice(e,i),s={code:1,msg:"sucess",data:{total:t.length,records:p}};s.code===1&&(x.value=s.data.records||[],V.value=s.data.total||0)}catch(t){console.error("获取资料列表失败:",t)}finally{m.value=!1}},A=f(!1),_=f(""),l=f({id:"",title:"",icon:"",type:"",content:"",points:""}),g=me({iconFileList:[],contentFileList:[]}),T=f(),M={title:[{required:!0,message:"请输入标题",trigger:"blur"}],icon:[{required:!0,message:"请上传图标",trigger:"change"}],type:[{required:!0,message:"请选择资料类型",trigger:"change"}],content:[{required:!0,message:"请上传文档",trigger:"change"}],points:[{required:!0,message:"请输入学习积分",trigger:"blur"}]},I=async()=>{T.value&&T.value.clearValidate();try{await T.value.validate(),m.value=!0;try{const t={...l.value},e={code:null,msg:null,data:null};r.success(l.value.id?"资料编辑成功":"资料添加成功"),A.value=!1,await v()}catch{r.error(l.value.id?"资料编辑失败":"资料添加失败")}finally{m.value=!1}}catch{}};f([{value:j,label:"文档"},{value:fe,label:"图片"},{value:ge,label:"文件夹"},{value:ve,label:"标签"}]),f([]);const O=t=>{T.value&&T.value.resetFields(),g.iconFileList=[],g.contentFileList=[],l.value.id=t.id,l.value.title=t.title,l.value.icon=t.icon,l.value.type=t.type?String(t.type):"",l.value.content=t.content,l.value.points=t.points,t.icon&&(g.iconFileList=[{name:"icon.png",url:t.icon}]),t.content&&(g.contentFileList=[{name:"content.pdf",url:t.content}]),A.value=!0},P=()=>{T.value&&T.value.resetFields(),g.iconFileList=[],g.contentFileList=[],l.value.id="",l.value.title="",l.value.icon="",l.value.type="",l.value.content="",l.value.points="",A.value=!0},q=(t,e)=>{l.value.icon=e.url||(e.raw?URL.createObjectURL(e.raw):"")},E=(t,e)=>{l.value.content=e.url||(e.raw?URL.createObjectURL(e.raw):"")},G=t=>{const e=t.type==="image/jpeg"||t.type==="image/png"||t.type==="image/gif",i=t.size/1024/1024<2;return e||r.error("图标只能是 JPG/PNG/GIF 格式!"),i||r.error("图标大小不能超过 2MB!"),e&&i},N=t=>{const e=t.type==="application/pdf"||t.type==="application/msword"||t.type==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",i=t.size/1024/1024<10;return e||r.error("文档只能是 PDF/DOC/DOCX 格式!"),i||r.error("文档大小不能超过 10MB!"),e&&i},X=(t,e)=>{if(g.iconFileList=e,e.length===0)l.value.icon="";else{const i=e[e.length-1];l.value.icon=i.url||(i.raw?URL.createObjectURL(i.raw):"")}},J=(t,e)=>{if(g.contentFileList=e,e.length===0)l.value.content="";else{const i=e[e.length-1];l.value.content=i.url||(i.raw?URL.createObjectURL(i.raw):"")}},Q=async()=>{if(_.value.trim()){m.value=!0;try{const t=[{id:"43de40e1dfee6ec94941ce70f8d16634",number:"760731",title:"拆反正猛然哎哎呀索性关于发型加上",icon:"https://avatars.githubusercontent.com/u/85906775",content:"tjtnt",type:"1",points:2,releaseTime:null,status:2,updateTime:"2025-09-15 11:26:07"},{id:"55263b8d9138456ebd3d279e3db0db55",number:"967463",title:"拆反正猛然哎哎呀索性关于发型加上",icon:"https://avatars.githubusercontent.com/u/85906775",content:"tjtnt",type:"2",points:2,releaseTime:null,status:2,updateTime:"2025-09-15 09:51:26"},{id:"6270477908343df3f70d3e169250e10c",number:"172185",title:"尴尬的",icon:"https://avatars.githubusercontent.com/u/85906775",content:"sit et",type:"1",points:10,releaseTime:null,status:2,updateTime:"2025-09-15 09:50:43"},{id:"DATA_001",number:"DATA-2023001",title:"入党流程指南",icon:"icon1.png",content:"http://example.com/data1.pdf",type:"1",points:45,releaseTime:"2025-05-25 17:19:00",status:1,updateTime:"2025-05-25 17:19:00"},{id:"DATA_003",number:"DATA-2023003",title:"党章解读",icon:"icon3.png",content:"http://example.com/data1.pdf",type:"2",points:2,releaseTime:"2025-09-15 14:39:24",status:1,updateTime:"2025-09-15 14:39:24"},{id:"DATA_004",number:"DATA-2023004",title:"党员发展工作手册",icon:"icon4.png",content:"http://example.com/data4.pdf",type:"1",points:3,releaseTime:"2025-09-15 15:30:00",status:1,updateTime:"2025-09-15 15:30:00"},{id:"DATA_005",number:"DATA-2023005",title:"党的基本知识教育",icon:"icon5.png",content:"http://example.com/data5.pdf",type:"2",points:5,releaseTime:"2025-09-16 09:20:00",status:1,updateTime:"2025-09-16 09:20:00"},{id:"DATA_006",number:"DATA-2023006",title:"党性修养提升",icon:"icon6.png",content:"http://example.com/data6.pdf",type:"1",points:4,releaseTime:null,status:2,updateTime:"2025-09-16 10:15:00"},{id:"DATA_007",number:"DATA-2023007",title:"党风廉政建设",icon:"icon7.png",content:"http://example.com/data7.pdf",type:"2",points:6,releaseTime:"2025-09-16 14:40:00",status:1,updateTime:"2025-09-16 14:40:00"},{id:"DATA_008",number:"DATA-2023008",title:"党史学习教育",icon:"icon8.png",content:"http://example.com/data8.pdf",type:"1",points:7,releaseTime:null,status:2,updateTime:"2025-09-17 08:50:00"},{id:"DATA_009",number:"DATA-2023009",title:"党的组织工作条例",icon:"icon9.png",content:"http://example.com/data9.pdf",type:"2",points:8,releaseTime:"2025-09-17 11:30:00",status:1,updateTime:"2025-09-17 11:30:00"},{id:"DATA_010",number:"DATA-2023010",title:"党员权利保障条例",icon:"icon10.png",content:"http://example.com/data10.pdf",type:"1",points:5,releaseTime:"2025-09-17 16:20:00",status:1,updateTime:"2025-09-17 16:20:00"},{id:"DATA_011",number:"DATA-2023011",title:"党支部工作手册",icon:"icon11.png",content:"http://example.com/data11.pdf",type:"2",points:6,releaseTime:null,status:2,updateTime:"2025-09-18 09:10:00"},{id:"DATA_012",number:"DATA-2023012",title:"党的群众路线教育",icon:"icon12.png",content:"http://example.com/data12.pdf",type:"1",points:9,releaseTime:"2025-09-18 13:45:00",status:1,updateTime:"2025-09-18 13:45:00"},{id:"DATA_013",number:"DATA-2023013",title:"党员先锋模范作用",icon:"icon13.png",content:"http://example.com/data13.pdf",type:"2",points:7,releaseTime:null,status:2,updateTime:"2025-09-18 15:20:00"}],e=_.value.trim().toLowerCase(),i=t.filter(d=>d.title.toLowerCase().includes(e)||d.content.toLowerCase().includes(e)||d.number.toLowerCase().includes(e));y.value=1;const p=(y.value-1)*b.value,s=p+b.value,k=i.slice(p,s),h={code:1,msg:"sucess",data:{total:i.length,records:k}};h.code===1&&(x.value=h.data.records||[],V.value=h.data.total||0,i.length===0&&r.info(`未找到包含"${_.value.trim()}"的资料`))}catch(t){console.error("搜索资料失败:",t),r.error("搜索失败，请稍后重试")}finally{m.value=!1}}},W=()=>{_.value="",v()},Y=async t=>{m.value=!0;try{if({code:1,msg:"sucess",data:null}.code===1){await v(),r.success("资料发布成功");const i=x.value.findIndex(p=>p.id===t.id);i!==-1&&(x.value[i].status=1)}}catch(e){console.error("发布资料失败:",e)}finally{m.value=!1}},H=async t=>{try{const e=t.status===1?"2":"1",i=t.status===1?"未发布":"已发布";await F.confirm(`确定要将资料「${t.title}」的状态修改为"${i}"吗？`,"确认修改状态",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),m.value=!0;const p={code:1,msg:"sucess",data:null};r.success("资料状态修改成功"),await v()}catch(e){e instanceof Error||r.error("资料状态修改失败")}finally{m.value=!1}},U=async t=>{m.value=!0;try{const e={code:null,msg:null,data:null};r.success("删除成功"),await v(),C.value=[]}catch(e){console.error("删除失败:",e),r.error("删除失败")}finally{m.value=!1}},K=t=>{F.confirm(`确定要删除资料「${t.title}」吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{U(t.id)}).catch(()=>{})},Z=()=>{if(C.value.length===0){r.warning("请选择要删除的资料");return}F.confirm(`确定要删除选中的 ${C.value.length} 条资料吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{C.value.map(t=>t.id).join(","),U()}).catch(()=>{})},ee=t=>{C.value=t},te=t=>{y.value=t,v()},ne=t=>{b.value=t,y.value=1,v()};return(t,e)=>{const i=c("el-input"),p=c("el-form-item"),s=c("el-button"),k=c("el-form"),h=c("el-card"),d=c("el-table-column"),ae=c("el-icon"),le=c("el-tag"),oe=c("el-table"),ie=c("el-pagination"),B=c("el-upload"),S=c("el-radio"),se=c("el-radio-group"),ue=c("el-input-number"),pe=c("el-dialog"),ce=ye("loading");return D(),R("div",Ae,[n(h,null,{default:a(()=>[n(k,{inline:!0,class:"form"},{default:a(()=>[n(p,{label:"资料信息"},{default:a(()=>[n(i,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=o=>_.value=o),placeholder:"资料信息",clearable:""},null,8,["modelValue"])]),_:1}),n(p,null,{default:a(()=>[n(s,{type:"primary",size:"default",icon:"Search",onClick:Q,disabled:!_.value.trim()},{default:a(()=>[...e[8]||(e[8]=[u("搜索",-1)])]),_:1},8,["disabled"]),n(s,{type:"primary",size:"default",icon:"Refresh",onClick:W},{default:a(()=>[...e[9]||(e[9]=[u("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),n(h,{style:{"margin-top":"10px"}},{default:a(()=>[w("div",he,[n(s,{type:"primary",size:"default",icon:"Plus",onClick:P},{default:a(()=>[...e[10]||(e[10]=[u("添加资料",-1)])]),_:1}),n(s,{type:"danger",size:"default",icon:"Delete",onClick:Z},{default:a(()=>[...e[11]||(e[11]=[u("批量删除",-1)])]),_:1})]),w("div",De,[Te((D(),L(oe,{border:"",fit:"",data:x.value,onSelectionChange:ee},{default:a(()=>[n(d,{type:"selection",width:"55",align:"center",fixed:"left"}),n(d,{type:"index",align:"center",label:"#",fixed:"left"}),n(d,{label:"标题",align:"center","show-overflow-tooltip":"",prop:"title"}),n(d,{label:"图标",align:"center"},{default:a(({row:o})=>[o.icon&&o.icon.includes("http")?(D(),R("div",xe,[w("img",{src:o.icon.trim(),alt:"图标",class:"icon-image"},null,8,Ce)])):(D(),R("div",we,[n(ae,null,{default:a(()=>[n(be(j))]),_:1})]))]),_:1}),n(d,{label:"内容",align:"center","show-overflow-tooltip":"",prop:"content"}),n(d,{label:"积分",align:"center","show-overflow-tooltip":"",prop:"points"}),n(d,{label:"发布时间",align:"center","show-overflow-tooltip":"",prop:"releaseTime"},{default:a(({row:o})=>[u($(o.releaseTime||"-"),1)]),_:1}),n(d,{label:"状态",align:"center","show-overflow-tooltip":"",prop:"status"},{default:a(({row:o})=>[n(le,{type:o.status===1?"success":"warning"},{default:a(()=>[u($(o.status===1?"已发布":"未发布"),1)]),_:2},1032,["type"])]),_:1}),n(d,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"updateTime"}),n(d,{label:"操作",width:"360",align:"center",fixed:"right"},{default:a(({row:o})=>[n(s,{type:"primary",size:"small",plain:"",icon:"Edit",onClick:z=>O(o)},{default:a(()=>[...e[12]||(e[12]=[u("编辑",-1)])]),_:1},8,["onClick"]),o.status===1?(D(),L(s,{key:0,type:"success",size:"small",disabled:"",plain:""},{default:a(()=>[...e[13]||(e[13]=[u("已发布",-1)])]),_:1})):(D(),L(s,{key:1,type:"success",size:"small",icon:"Upload",onClick:z=>Y(o),plain:""},{default:a(()=>[...e[14]||(e[14]=[u("发布",-1)])]),_:1},8,["onClick"])),n(s,{type:"info",size:"small",icon:"Download",onClick:z=>H(o),plain:""},{default:a(()=>[...e[15]||(e[15]=[u("资料状态",-1)])]),_:1},8,["onClick"]),n(s,{type:"danger",size:"small",icon:"Delete",onClick:z=>K(o),plain:""},{default:a(()=>[...e[16]||(e[16]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ce,m.value]])]),n(ie,{"page-sizes":[10,20,30,40],background:!0,layout:" prev, pager, next, jumper,->,sizes,total",total:V.value,"current-page":y.value,"onUpdate:currentPage":e[1]||(e[1]=o=>y.value=o),"page-size":b.value,"onUpdate:pageSize":e[2]||(e[2]=o=>b.value=o),onCurrentChange:te,onSizeChange:ne},null,8,["total","current-page","page-size"])]),_:1}),n(pe,{modelValue:A.value,"onUpdate:modelValue":e[7]||(e[7]=o=>A.value=o),title:l.value.id?"编辑资料":"添加资料",width:"600px"},{footer:a(()=>[n(s,{icon:"Close",onClick:e[6]||(e[6]=o=>A.value=!1)},{default:a(()=>[...e[23]||(e[23]=[u("取消",-1)])]),_:1}),n(s,{type:"primary",icon:"Check",onClick:I},{default:a(()=>[...e[24]||(e[24]=[u("确定",-1)])]),_:1})]),default:a(()=>[n(k,{ref_key:"formRef",ref:T,model:l.value,"label-width":"80px",rules:M},{default:a(()=>[n(p,{label:"标题",prop:"title"},{default:a(()=>[n(i,{modelValue:l.value.title,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.title=o),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),n(p,{label:"图标",prop:"icon"},{default:a(()=>[n(B,{class:"upload-demo",action:"#","auto-upload":!1,"file-list":g.iconFileList,"on-change":X,"before-upload":G,"on-success":q,"list-type":"picture",accept:"image/*"},{tip:a(()=>[...e[18]||(e[18]=[w("div",{class:"el-upload__tip"}," jpg/png/gif 文件，大小不超过 2MB ",-1)])]),default:a(()=>[n(s,{type:"primary"},{default:a(()=>[...e[17]||(e[17]=[u("选择图标文件",-1)])]),_:1})]),_:1},8,["file-list"])]),_:1}),n(p,{label:"类型",prop:"type"},{default:a(()=>[n(se,{modelValue:l.value.type,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.type=o)},{default:a(()=>[n(S,{label:"1",border:""},{default:a(()=>[...e[19]||(e[19]=[u("视频资料",-1)])]),_:1}),n(S,{label:"2",border:""},{default:a(()=>[...e[20]||(e[20]=[u("图文资料",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(p,{label:"文档",prop:"content"},{default:a(()=>[n(B,{class:"upload-demo",action:"#","auto-upload":!1,"file-list":g.contentFileList,"on-change":J,"before-upload":N,"on-success":E,"list-type":"text",accept:".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"},{tip:a(()=>[...e[22]||(e[22]=[w("div",{class:"el-upload__tip"}," pdf/doc/docx 文件，大小不超过 10MB ",-1)])]),default:a(()=>[n(s,{type:"primary"},{default:a(()=>[...e[21]||(e[21]=[u("选择文档文件",-1)])]),_:1})]),_:1},8,["file-list"])]),_:1}),n(p,{label:"学习积分",prop:"points"},{default:a(()=>[n(ue,{modelValue:l.value.points,"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.points=o),min:1,max:100,placeholder:"请输入学习积分","controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Re=_e(ke,[["__scopeId","data-v-4fc271ac"]]);export{Re as default};
