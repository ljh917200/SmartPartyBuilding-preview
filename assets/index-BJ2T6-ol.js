import{h as W,D as O,r as u,ag as I,G as X,c as C,f as t,a as i,w as n,p as l,$ as m,s as F,M as Y,k as Z,ah as ee,ai as te,a2 as N,B as p,o as f,g as T,aj as V,a6 as ae,a7 as b,a8 as U,ak as $,j as le,t as v,F as se,i as oe,z as ie,_ as ne}from"./index-BxqgcJHC.js";const de={class:"vote-container"},re={class:"card-wrapper"},ue={class:"button-section"},pe={class:"table-wrapper"},ve={class:"pagination-section"},ce={class:"dialog-footer"},me={class:"detail-container"},fe={key:0,class:"detail-content"},Te={class:"detail-item"},ye={class:"detail-value"},_e={class:"detail-item"},ge={class:"detail-value"},Ce={class:"detail-item"},Ve={class:"detail-value"},be={class:"detail-item"},Ee={class:"options-list"},De={class:"detail-item"},ke={class:"detail-value"},Be={class:"detail-item"},Se={class:"detail-value"},we={class:"detail-item"},he={class:"detail-value"},xe={class:"detail-item"},Ie={class:"detail-value"},Ue={class:"detail-item"},ze={class:"detail-value"},Re={class:"detail-item"},Oe={class:"detail-value"},Fe=W({__name:"index",setup(Ne){const c=O({currentPage:1,pageSize:10,total:0}),k=u([]),y=u(!1),_=async()=>{y.value=!0;try{const s={code:1,msg:"sucess",data:{total:5,records:[{id:"VOTE_001",voteTitle:"最佳志愿者评选",voteContent:"评选本次志愿服务活动表现最佳的志愿者",options:'["张三", "李四", "王五", "赵六", "钱七"]',startTime:"2023-10-20 09:00:00",endTime:"2023-10-27 17:00:00",createBy:"USER_003",createTime:"2025-05-25 17:19:00",updateBy:"USER_003",updateTime:"2025-05-25 17:19:00",isDelete:2},{id:"VOTE_002",voteTitle:"下季度活动主题投票",voteContent:"选择下季度党组织活动主题",options:'["红色教育基地参观", "党史知识讲座", "志愿服务活动", "主题演讲比赛", "读书会"]',startTime:"2023-11-01 09:00:00",endTime:"2023-11-07 17:00:00",createBy:"USER_003",createTime:"2025-05-25 17:19:00",updateBy:"USER_003",updateTime:"2025-05-25 17:19:00",isDelete:2},{id:"VOTE_003",voteTitle:"优秀党员评选",voteContent:"评选本季度优秀共产党员",options:'["党员A", "党员B", "党员C", "党员D", "党员E"]',startTime:"2023-12-01 09:00:00",endTime:"2023-12-07 17:00:00",createBy:"USER_003",createTime:"2025-05-25 17:19:00",updateBy:"USER_003",updateTime:"2025-05-25 17:19:00",isDelete:2},{id:"VOTE_004",voteTitle:"活动组织满意度调查",voteContent:"对近期党组织活动的满意度评价",options:'["非常满意", "满意", "一般", "不满意", "非常不满意"]',startTime:"2024-01-01 09:00:00",endTime:"2024-01-07 17:00:00",createBy:"USER_003",createTime:"2025-05-25 17:19:00",updateBy:"USER_003",updateTime:"2025-05-25 17:19:00",isDelete:2},{id:"VOTE_005",voteTitle:"党员发展对象推荐",voteContent:"推荐下一批党员发展对象",options:'["候选人A", "候选人B", "候选人C", "候选人D", "候选人E"]',startTime:"2024-01-10 09:00:00",endTime:"2024-01-17 17:00:00",createBy:"USER_003",createTime:"2025-05-25 17:19:00",updateBy:"USER_003",updateTime:"2025-05-25 17:19:00",isDelete:2}]}};s.code===1&&(k.value=s.data.records,c.total=s.data.total)}catch(s){console.error("获取投票列表失败",s),p.error("获取投票列表失败，请稍后重试")}finally{y.value=!1}},P=async s=>{try{({code:1,msg:null,data:null}).code==1&&(p.success("删除成功"),await _())}catch{p.error("删除失败，请稍后重试")}},j=async s=>{try{await ie.confirm("确定要删除该投票吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P(s.id)}catch{}},A=s=>{c.currentPage=s,_()},M=s=>{c.pageSize=s,c.currentPage=1,_()},J=s=>{try{return JSON.parse(s)}catch{return[]}},a=O({voteInTitle:"",voteInContent:"",options:"",startTime:"",endTime:""}),B=u(I(a)),g=u(!1),z=u("添加投票"),S=u("add"),L=u(""),w=u(),E=u(!1),h=u(!1),d=u(null),q=async(s,e=!0)=>{h.value=!0;try{const r=k.value.find(o=>o.id===s);if(r){const o={...r};return e&&(d.value=o,E.value=!0),o}else return p.error("获取详情失败，未找到对应投票"),null}catch(r){return p.error("获取详情失败，请稍后重试"),console.error("获取投票详情失败",r),null}finally{h.value=!1}},G=()=>{E.value=!1,d.value=null},R=async(s="add",e)=>{if(S.value=s,z.value=s==="add"?"添加投票":"编辑投票",w.value&&w.value.clearValidate(),s==="add")Object.keys(a).forEach(r=>{r!=="id"&&(a[r]="")}),delete a.id,B.value=I(a),g.value=!0;else if(e){L.value=e.id,a.id=e.id,a.voteInTitle=e.voteTitle,a.voteInContent=e.voteContent;try{const r=JSON.parse(e.options);a.options=Array.isArray(r)?r.join(","):e.options}catch{a.options=e.options}a.startTime=e.startTime,a.endTime=e.endTime,B.value=I(a),g.value=!0}},x=()=>{g.value=!1},H=()=>{const s=[{key:"voteInTitle",name:"投票标题"},{key:"options",name:"投票选项"},{key:"endTime",name:"结束时间"}];for(const e of s)if(!a[e.key])return p.warning(`${e.name}不能为空`),!1;return!0},K=()=>JSON.stringify(a)!==JSON.stringify(B.value),Q=async()=>{if(H()){if(S.value==="edit"&&!K()){p.warning("未做任何修改，无需提交");return}y.value=!0;try{const s={...a,options:`[${a.options.split(",").map(e=>`"${e.trim()}"`).join(",")}]`};S.value==="add"?p.success("添加成功"):p.success("修改成功"),x(),await _()}catch{p.error("操作失败，请稍后重试")}finally{y.value=!1}}};return X(()=>{_()}),(s,e)=>{const r=Y("loading");return f(),C("div",de,[t("div",re,[t("div",ue,[i(l(m),{type:"primary",icon:"Plus",onClick:e[0]||(e[0]=o=>R("add"))},{default:n(()=>[...e[8]||(e[8]=[T("添加投票",-1)])]),_:1})]),t("div",pe,[F((f(),Z(l(ee),{data:k.value,style:{width:"100%"},fit:"",size:"default",stripe:"",border:""},{default:n(()=>[i(l(V),{prop:"voteTitle",label:"投票标题",fixed:"left","show-overflow-tooltip":""}),i(l(V),{prop:"voteContent",label:"投票内容","show-overflow-tooltip":""}),i(l(V),{prop:"startTime",label:"开始时间","show-overflow-tooltip":""}),i(l(V),{prop:"endTime",label:"结束时间","show-overflow-tooltip":""}),i(l(V),{label:"操作",width:"270",fixed:"right"},{default:n(({row:o})=>[i(l(m),{size:"small",type:"primary",plain:"",icon:"View",onClick:D=>q(o.id)},{default:n(()=>[...e[9]||(e[9]=[T("详情",-1)])]),_:1},8,["onClick"]),i(l(m),{size:"small",type:"success",plain:"",icon:"Edit",onClick:D=>R("edit",o)},{default:n(()=>[...e[10]||(e[10]=[T("编辑",-1)])]),_:1},8,["onClick"]),i(l(m),{size:"small",type:"danger",plain:"",icon:"Delete",onClick:D=>j(o)},{default:n(()=>[...e[11]||(e[11]=[T("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[r,y.value]])]),t("div",ve,[i(l(te),{"page-size":c.pageSize,"current-page":c.currentPage,background:!0,layout:"prev, pager, next, jumper,->,sizes, total",total:c.total,onCurrentChange:A,onSizeChange:M},null,8,["page-size","current-page","total"])])]),i(l(N),{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=o=>g.value=o),title:z.value,width:"600px",onClose:x},{footer:n(()=>[t("span",ce,[i(l(m),{onClick:x},{default:n(()=>[...e[13]||(e[13]=[T("取消",-1)])]),_:1}),i(l(m),{type:"primary",onClick:Q},{default:n(()=>[...e[14]||(e[14]=[T("确定",-1)])]),_:1})])]),default:n(()=>[i(l(ae),{ref_key:"formRef",ref:w,model:a,"label-width":"100px",class:"vote-form"},{default:n(()=>[i(l(b),{label:"投票标题",prop:"voteInTitle"},{default:n(()=>[i(l(U),{modelValue:a.voteInTitle,"onUpdate:modelValue":e[1]||(e[1]=o=>a.voteInTitle=o),placeholder:"请输入投票标题"},null,8,["modelValue"])]),_:1}),i(l(b),{label:"投票内容",prop:"voteInContent"},{default:n(()=>[i(l(U),{modelValue:a.voteInContent,"onUpdate:modelValue":e[2]||(e[2]=o=>a.voteInContent=o),type:"textarea",rows:4,placeholder:"请输入投票内容"},null,8,["modelValue"])]),_:1}),i(l(b),{label:"投票选项",prop:"options"},{default:n(()=>[i(l(U),{modelValue:a.options,"onUpdate:modelValue":e[3]||(e[3]=o=>a.options=o),placeholder:"请输入投票选项，用逗号分隔"},null,8,["modelValue"]),e[12]||(e[12]=t("div",{class:"form-tip"},"多个选项请用英文逗号分隔",-1))]),_:1}),i(l(b),{label:"开始时间",prop:"startTime"},{default:n(()=>[i(l($),{modelValue:a.startTime,"onUpdate:modelValue":e[4]||(e[4]=o=>a.startTime=o),type:"datetime",placeholder:"请选择开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),i(l(b),{label:"结束时间",prop:"endTime"},{default:n(()=>[i(l($),{modelValue:a.endTime,"onUpdate:modelValue":e[5]||(e[5]=o=>a.endTime=o),type:"datetime",placeholder:"请选择结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),i(l(N),{modelValue:E.value,"onUpdate:modelValue":e[7]||(e[7]=o=>E.value=o),title:"投票详情",width:"600px",onClose:G},{default:n(()=>[F((f(),C("div",me,[d.value?(f(),C("div",fe,[t("div",Te,[e[15]||(e[15]=t("span",{class:"detail-label"},"投票ID：",-1)),t("span",ye,v(d.value.id),1)]),t("div",_e,[e[16]||(e[16]=t("span",{class:"detail-label"},"投票标题：",-1)),t("span",ge,v(d.value.voteTitle),1)]),t("div",Ce,[e[17]||(e[17]=t("span",{class:"detail-label"},"投票内容：",-1)),t("span",Ve,v(d.value.voteContent),1)]),t("div",be,[e[18]||(e[18]=t("span",{class:"detail-label"},"投票选项：",-1)),t("div",Ee,[(f(!0),C(se,null,oe(J(d.value.options),(o,D)=>(f(),C("div",{key:D,class:"option-item"},v(o),1))),128))])]),t("div",De,[e[19]||(e[19]=t("span",{class:"detail-label"},"开始时间：",-1)),t("span",ke,v(d.value.startTime),1)]),t("div",Be,[e[20]||(e[20]=t("span",{class:"detail-label"},"结束时间：",-1)),t("span",Se,v(d.value.endTime),1)]),t("div",we,[e[21]||(e[21]=t("span",{class:"detail-label"},"创建人：",-1)),t("span",he,v(d.value.createBy),1)]),t("div",xe,[e[22]||(e[22]=t("span",{class:"detail-label"},"创建时间：",-1)),t("span",Ie,v(d.value.createTime),1)]),t("div",Ue,[e[23]||(e[23]=t("span",{class:"detail-label"},"更新人：",-1)),t("span",ze,v(d.value.updateBy),1)]),t("div",Re,[e[24]||(e[24]=t("span",{class:"detail-label"},"更新时间：",-1)),t("span",Oe,v(d.value.updateTime),1)])])):le("",!0)])),[[r,h.value]])]),_:1},8,["modelValue"])])}}}),Pe=ne(Fe,[["__scopeId","data-v-58f54fbb"]]);export{Pe as default};
