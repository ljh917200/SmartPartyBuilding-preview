import{h as le,r as p,D as k,G as oe,c as O,a as l,w as t,b as m,B as c,o as B,f as F,p as L,H as re,g as u,F as te,i as se,I as ne,J as ie,k as ue,_ as de}from"./index-BxqgcJHC.js";const me={class:"container"},pe={class:"table-wrapper"},fe=le({__name:"index",setup(ce){const S=p([]),w=p(1),_=p(10),A=p(0),x=p(!1),z=k({username:""}),y=async()=>{try{x.value=!0;const a={pageNum:w.value,pageSize:_.value,username:z.username},e=[{id:1001,username:"admin",name:"张三",roleName:"超级管理员",createTime:"2023-08-10 09:30:25",updateTime:"2023-08-15 14:20:10",password:"123456"},{id:1002,username:"user_zhangsan",name:"李四",roleName:"普通用户",createTime:"2023-08-12 10:15:00",updateTime:"2023-08-12 10:15:00",password:"123456"},{id:1003,username:"very_long_username_test_overflow_tooltip",name:"王五（测试长文本溢出显示效果）",roleName:"审计员",createTime:"2023-08-14 16:45:30",updateTime:"2023-08-14 16:45:30",password:"123456"},{id:1004,username:"user_lisi",name:"赵六",roleName:"普通用户",createTime:"2023-08-16 09:20:00",updateTime:"2023-08-16 09:20:00",password:"123456"},{id:1005,username:"user_wangwu",name:"钱七",roleName:"审计员",createTime:"2023-08-18 14:30:00",updateTime:"2023-08-18 14:30:00",password:"123456"},{id:1006,username:"user_zhaoliu",name:"孙八",roleName:"普通用户",createTime:"2023-08-20 10:45:00",updateTime:"2023-08-20 10:45:00",password:"123456"},{id:1007,username:"user_sunba",name:"周九",roleName:"管理员",createTime:"2023-08-22 15:20:00",updateTime:"2023-08-22 15:20:00",password:"123456"},{id:1008,username:"user_zhoujiu",name:"吴十",roleName:"普通用户",createTime:"2023-08-24 09:10:00",updateTime:"2023-08-24 09:10:00",password:"123456"},{id:1009,username:"user_wushi",name:"郑十一",roleName:"审计员",createTime:"2023-08-26 13:50:00",updateTime:"2023-08-26 13:50:00",password:"123456"},{id:1010,username:"user_zhengyishi",name:"王十二",roleName:"普通用户",createTime:"2023-08-28 11:30:00",updateTime:"2023-08-28 11:30:00",password:"123456"},{id:1011,username:"user_wangshieryi",name:"李十三",roleName:"管理员",createTime:"2023-08-30 16:40:00",updateTime:"2023-08-30 16:40:00",password:"123456"},{id:1012,username:"user_lishisan",name:"张十四",roleName:"普通用户",createTime:"2023-09-01 09:20:00",updateTime:"2023-09-01 09:20:00",password:"123456"}],n=(w.value-1)*_.value,i=n+_.value,f=e.slice(n,i);let T=f;z.username&&(T=f.filter(g=>g.username.toLowerCase().includes(z.username.toLowerCase())));const N={code:1,msg:"success",data:{total:e.length,records:T}};N.code===1&&N.data?(S.value=N.data.records,A.value=N.data.total):c.error(N.msg||"获取用户列表失败")}catch(a){console.error("获取用户列表出错:",a),c.error("获取用户列表出错，请重试")}finally{x.value=!1}},q=a=>{w.value=a,y()},$=a=>{_.value=a,w.value=1,y()};oe(()=>{y()});const V=p(!1),j=p(null),s=k({id:null,username:"",role:[]}),D=p([{value:"admin",label:"管理员"},{value:"user",label:"普通用户"},{value:"audit",label:"审计员"}]),P=async()=>{const a={data:{records:[{id:"ROLE_001",roleName:"系统管理员",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"ROLE_002",roleName:"教师",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"ROLE_003",roleName:"学生",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"ROLE_004",roleName:"部门负责人",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"ROLE_005",roleName:"普通管理员",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"}]}};a.data&&a.data.records&&(D.value=a.data.records.map(e=>({value:e.id,label:e.roleName})))},G=async a=>{if(await P(),s.id=a.id,s.username=a.username,s.role=[],a.roleIds)Array.isArray(a.roleIds)?s.role=a.roleIds.map(e=>String(e)):typeof a.roleIds=="string"&&(s.role=a.roleIds.split(",").map(e=>e.trim()));else if(a.roleId)s.role=[String(a.roleId)];else if(a.roleName)if(typeof a.roleName=="string"&&a.roleName.includes(",")){const e=[];a.roleName.split(",").forEach(n=>{const i=n.trim(),f=D.value.find(T=>T.label===i);f&&f.value&&e.push(String(f.value))}),s.role=e}else{const n=(typeof a.roleName=="string"?a.roleName:String(a.roleName)).trim(),i=D.value.find(f=>f.label===n);i&&i.value&&(s.role=[String(i.value)])}V.value=!0},H=async()=>{try{if(!s.role||s.role.length===0){c.warning("请至少选择一个角色");return}const a={userId:s.id,roleIds:s.role};console.log("分配角色:",a),{code:1,msg:"sucess",data:null}.code===1&&(c.success("角色分配成功"),V.value=!1,await y())}catch(a){console.error("角色分配失败:",a),c.error("角色分配失败，请重试")}},J=()=>{s.role=[]},v=p(!1),C=p(null),o=k({id:null,username:"",name:"",roleName:"",password:""}),d=p({}),K=k({id:[{required:!0,message:"请输入学号",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在3到20个字符",trigger:"blur"}],name:[{required:!0,message:"请输入用户名称",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],roleName:[{required:!0,message:"请输入用户角色",trigger:"blur"}]}),Q=a=>{U(),o.id=a.id,o.username=a.username,o.name=a.name,o.roleName=a.roleName,o.password=a.password,d.value={...a},v.value=!0},W=()=>{U(),Object.assign(o,{id:"",username:"",name:"",password:"",roleName:""}),d.value={},v.value=!0},U=()=>{C.value&&C.value.resetFields(),Object.assign(o,{id:"",username:"",name:"",password:"",roleName:""}),d.value={}},X=()=>!d.value||Object.keys(d.value).length===0?!0:o.id!==d.value.id||o.username!==d.value.username||o.name!==d.value.name||o.roleName!==d.value.roleName||d.value.password!==void 0&&o.password!==d.value.password,Y=async()=>{try{C.value&&await C.value.validate();const a=!d.value||!("id"in d.value)||!d.value.id;if(a){const e={id:o.id,username:o.username,name:o.name,password:o.password,roleName:o.roleName};({code:1,msg:"success",data:null}).code===1&&(c.success("添加用户成功"),v.value=!1,await y())}else if(!a){if(!X()){c.warning("请先修改用户信息后再提交");return}const e={userId:o.id,userName:o.username,image:"",password:o.password,status:1,isFirst:0};({code:1,msg:"success",data:null}).code===1&&(c.success("编辑用户成功"),v.value=!1,await y())}}catch(a){a!=="cancel"&&(console.error("操作失败:",a),c.error("操作失败，请重试"))}},Z=a=>{console.log("删除用户ID:",a)};return(a,e)=>{const n=m("el-button"),i=m("el-table-column"),f=m("el-popconfirm"),T=m("el-table"),R=m("el-pagination"),N=m("el-card"),g=m("el-input"),b=m("el-form-item"),h=m("el-icon"),ee=m("el-option"),ae=m("el-select"),E=m("el-form"),M=m("el-dialog");return B(),O("div",me,[l(N,{style:{margin:"10px 0"}},{default:t(()=>[l(n,{type:"primary",icon:L(re),size:"default",onClick:e[0]||(e[0]=r=>W())},{default:t(()=>[...e[15]||(e[15]=[u(" 添加用户 ",-1)])]),_:1},8,["icon"]),F("div",pe,[l(T,{style:{width:"100%"},border:"",data:S.value,loading:x.value,fit:""},{default:t(()=>[l(i,{label:"#",align:"center",type:"index",width:"60",fixed:"left"}),e[19]||(e[19]=u()),l(i,{label:"学号",align:"center",prop:"id","show-overflow-tooltip":""}),e[20]||(e[20]=u()),l(i,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),e[21]||(e[21]=u()),l(i,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),e[22]||(e[22]=u()),l(i,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),e[23]||(e[23]=u()),l(i,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),e[24]||(e[24]=u()),l(i,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),e[25]||(e[25]=u()),l(i,{label:"操作",width:"300px",align:"center",fixed:"right"},{default:t(({row:r})=>[l(n,{type:"info",plain:"",size:"small",icon:"User",onClick:I=>G(r)},{default:t(()=>[...e[16]||(e[16]=[u("分配角色",-1)])]),_:1},8,["onClick"]),l(n,{type:"primary",plain:"",size:"small",icon:"Edit",onClick:I=>Q(r)},{default:t(()=>[...e[17]||(e[17]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(f,{title:"你确定要删除admin?",onConfirm:I=>Z(r.id),width:"260px"},{reference:t(()=>[l(n,{type:"danger",plain:"",size:"small",icon:"Delete"},{default:t(()=>[...e[18]||(e[18]=[u("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data","loading"])]),l(R,{"current-page":w.value,"onUpdate:currentPage":e[1]||(e[1]=r=>w.value=r),"page-size":_.value,"onUpdate:pageSize":e[2]||(e[2]=r=>_.value=r),"page-sizes":[5,10,20,50],background:!0,layout:"prev, pager, next, jumper,->,sizes, total",total:A.value,onSizeChange:$,onCurrentChange:q},null,8,["current-page","page-size","total"])]),_:1}),l(M,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=r=>V.value=r),title:"分配角色",width:"30%",onClose:J},{footer:t(()=>[l(n,{onClick:e[6]||(e[6]=r=>V.value=!1)},{default:t(()=>[...e[27]||(e[27]=[u("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:H},{default:t(()=>[...e[28]||(e[28]=[u("确认分配",-1)])]),_:1})]),default:t(()=>[l(E,{model:s,"label-width":"80px"},{default:t(()=>[l(b,{label:"当前用户"},{default:t(()=>[l(g,{modelValue:s.username,"onUpdate:modelValue":e[3]||(e[3]=r=>s.username=r),disabled:""},null,8,["modelValue"])]),_:1}),l(b,{label:"选择角色",prop:"role"},{default:t(()=>[l(ae,{modelValue:s.role,"onUpdate:modelValue":e[5]||(e[5]=r=>s.role=r),placeholder:"请选择角色",multiple:"",ref_key:"roleSelect",ref:j},{suffix:t(()=>[l(n,{onClick:e[4]||(e[4]=ne(r=>{var I;return(I=a.$refs.roleSelect)==null?void 0:I.blur()},["stop"])),size:"small",circle:"",type:"text",class:"close-icon"},{default:t(()=>[l(h,null,{default:t(()=>[l(L(ie))]),_:1})]),_:1})]),default:t(()=>[(B(!0),O(te,null,se(D.value,r=>(B(),ue(ee,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[26]||(e[26]=F("div",{class:"el-form-item__error"},"提示：可多选角色",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(M,{modelValue:v.value,"onUpdate:modelValue":e[14]||(e[14]=r=>v.value=r),title:o.id?"编辑用户":"添加用户",width:"30%",onClose:U},{footer:t(()=>[l(n,{onClick:e[13]||(e[13]=r=>v.value=!1)},{default:t(()=>[...e[29]||(e[29]=[u("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:Y,disabled:!o.id||!o.username||!o.name||!o.password||!o.roleName},{default:t(()=>[...e[30]||(e[30]=[u("保存修改",-1)])]),_:1},8,["disabled"])]),default:t(()=>[l(E,{model:o,rules:K,ref_key:"editFormRef",ref:C,"label-width":"80px"},{default:t(()=>[l(b,{label:"学号",prop:"id"},{default:t(()=>[l(g,{modelValue:o.id,"onUpdate:modelValue":e[8]||(e[8]=r=>o.id=r)},null,8,["modelValue"])]),_:1}),l(b,{label:"用户名字",prop:"username"},{default:t(()=>[l(g,{modelValue:o.username,"onUpdate:modelValue":e[9]||(e[9]=r=>o.username=r)},null,8,["modelValue"])]),_:1}),l(b,{label:"用户名称",prop:"name"},{default:t(()=>[l(g,{modelValue:o.name,"onUpdate:modelValue":e[10]||(e[10]=r=>o.name=r)},null,8,["modelValue"])]),_:1}),l(b,{label:"用户密码",prop:"password"},{default:t(()=>[l(g,{modelValue:o.password,"onUpdate:modelValue":e[11]||(e[11]=r=>o.password=r)},null,8,["modelValue"])]),_:1}),l(b,{label:"用户角色",prop:"role"},{default:t(()=>[l(g,{modelValue:o.roleName,"onUpdate:modelValue":e[12]||(e[12]=r=>o.roleName=r)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),ve=de(fe,[["__scopeId","data-v-45e15f81"]]);export{ve as default};
