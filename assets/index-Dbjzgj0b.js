import{h as ye,r as o,G as fe,D as Y,c as Me,a as t,w as l,b as m,p as u,x as C,B as n,o as z,I as ve,K as ge,g as p,f as k,k as j,j as $,L as Ne,q as R,z as Te,_ as Re}from"./index-BxqgcJHC.js";const Ee={class:"container"},Ie={style:{"margin-bottom":"10px",display:"flex",gap:"10px"}},De={class:"table-wrapper"},Pe={style:{flex:"auto"}},Be=ye({__name:"index",setup(be){const w=o([]),x=o(0),E=o(!1),g=o(1),_=o(5),T=o(""),I=o(!1),D=o([]),y=async(a=1,e=5)=>{E.value=!0;try{let d={code:1,msg:"sucess",data:{total:5,records:[{id:"ROLE_001",roleName:"系统管理员",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"ROLE_002",roleName:"教师",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"ROLE_003",roleName:"学生",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"ROLE_004",roleName:"部门负责人",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"ROLE_005",roleName:"普通管理员",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"}]}};d.code===1&&(w.value=d.data.records,x.value=d.data.total)}catch{n.error("获取角色列表失败，请重试")}finally{E.value=!1}},q=a=>{g.value=a,y(a,_.value)},G=a=>{_.value=a,y(g.value,a)},O=async()=>{if(T.value.trim()){I.value=!0;try{let a={code:1,msg:"sucess",data:{id:T.value.trim(),roleName:"系统管理员",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"}};a.code===1&&(w.value=[a.data],x.value=1)}catch(a){n.error("搜索失败，请重试"),console.error("搜索角色失败:",a)}finally{I.value=!1}}},F=()=>{T.value="",y(1,_.value)};fe(()=>{y()});let c=o(!1),i=Y({id:"",roleName:"",createPeople:""});const P=o(),H=Y({roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:1,max:50,message:"角色名称长度在1到50个字符之间",trigger:"blur"}]}),V=o({roleName:""}),B=o(!1),J=()=>{c.value=!0,Object.assign(i,{roleName:"",id:"",createPeople:"ADMIN"}),B.value=!1,V.value={roleName:""}},Q=a=>{c.value=!0,Object.assign(i,a),V.value={roleName:a.roleName},B.value=!1,R(()=>{P.value&&P.value.clearValidate("roleName")})},W=()=>{i.id?B.value=i.roleName!==V.value.roleName:B.value=i.roleName.trim()!==""},X=async()=>{if(P.value)try{if(await P.value.validate(),i.id&&!B.value){n.warning("请先修改角色信息后再提交");return}i.id?{code:1,msg:"sucess",data:null}.code===1&&(n.success("更新角色成功"),c.value=!1,g.value=1,y(1,_.value)):{code:1,msg:"sucess",data:null}.code===1&&(n.success("添加角色成功"),c.value=!1,g.value=1,y(1,_.value))}catch(a){console.error("操作失败:",a),n.error("操作失败，请重试")}},Z=async a=>{try{({code:1,msg:"success",data:null}).code===1&&(n.success("删除角色成功"),g.value=1,y(1,_.value))}catch{n.error("删除角色失败，请重试")}};let f=o(!1);const S=o([]),M=o([]),U=o([]),h=o(),ee=o(""),b=o([]),ae=async a=>{Object.assign(i,a),ee.value=a.id,M.value=[],b.value=[];try{let e={code:1,msg:"success",data:{total:15,records:[{id:"SYS_001",describe:"系统管理",url:"/system",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53",children:[{id:"PERM_001",describe:"用户管理",url:"/user/manage",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53",children:[{id:"PERM_001_001",describe:"用户新增",url:"/user/add",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"PERM_001_002",describe:"用户编辑",url:"/user/edit",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"PERM_001_003",describe:"用户删除",url:"/user/delete",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"}]},{id:"PERM_006",describe:"角色管理",url:"/role/manage",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53",children:[{id:"PERM_006_001",describe:"角色分配",url:"/role/assign",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"}]}]},{id:"CONTENT_001",describe:"内容管理",url:"/content",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53",children:[{id:"PERM_002",describe:"资料管理",url:"/datas/manage",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53",children:[{id:"PERM_002_001",describe:"资料上传",url:"/datas/upload",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"PERM_002_002",describe:"资料审核",url:"/datas/audit",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"}]}]},{id:"EDU_001",describe:"教务管理",url:"/education",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53",children:[{id:"PERM_003",describe:"考试管理",url:"/examination/manage",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53",children:[{id:"PERM_003_001",describe:"考试安排",url:"/examination/schedule",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"PERM_003_002",describe:"成绩管理",url:"/examination/score",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"}]}]},{id:"ACTIVITY_001",describe:"活动管理",url:"/activity",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53",children:[{id:"PERM_004",describe:"活动管理",url:"/action/manage",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53",children:[{id:"PERM_004_001",describe:"活动创建",url:"/action/create",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"PERM_004_002",describe:"活动审批",url:"/action/approve",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"}]},{id:"PERM_005",describe:"签到管理",url:"/sign/manage",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53",children:[{id:"PERM_005_001",describe:"签到统计",url:"/sign/statistics",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"},{id:"PERM_005_002",describe:"签到导出",url:"/sign/export",createBy:"ADMIN",createTime:"2025-05-25 17:15:53",updateBy:"ADMIN",updateTime:"2025-05-25 17:15:53"}]}]}]}};if(e.code===1){S.value=e.data.records;const d=N=>N.map(s=>{const A={...s,name:s.describe};return s.children&&s.children.length>0&&(A.children=d(s.children)),A});M.value=[],U.value=d(S.value),await R(),await te(a.id),await R(),b.value=[...M.value],console.log("已获取角色权限，等待drawer打开后设置:",b.value),f.value=!0}}catch(e){console.error("获取权限列表失败:",e),n.error("获取权限列表失败，请重试")}},te=async a=>{try{let e=[];a==="ROLE_001"?e=["SYS_001","PERM_001","PERM_001_001","PERM_001_002","PERM_001_003","PERM_006","PERM_006_001","CONTENT_001","PERM_002","PERM_002_001","PERM_002_002","EDU_001","PERM_003","PERM_003_001","PERM_003_002","ACTIVITY_001","PERM_004","PERM_004_001","PERM_004_002","PERM_005","PERM_005_001","PERM_005_002"]:a==="ROLE_002"?e=["CONTENT_001","PERM_002","PERM_002_001","PERM_002_002","EDU_001","PERM_003","PERM_003_001","PERM_003_002"]:a==="ROLE_004"?e=["SYS_001","PERM_001","PERM_001_001","PERM_001_002","PERM_001_003","CONTENT_001","PERM_002","PERM_002_001","PERM_002_002","ACTIVITY_001","PERM_004","PERM_004_001","PERM_004_002"]:e=["ACTIVITY_001","PERM_005","PERM_005_001","PERM_005_002"],M.value=e}catch(e){console.error("获取角色权限失败:",e),n.error("获取角色权限失败，请重试")}},le=async()=>{await R(),await new Promise(a=>setTimeout(a,100)),M.value=[...b.value],await R(),h.value&&(console.log("使用tree组件方法强制设置勾选状态"),h.value.setCheckedKeys([]),await R(),h.value.setCheckedKeys(b.value)),console.log("权限设置完成，当前checkedKeys:",M.value)},re=async()=>{try{({code:1,msg:"success",data:null}).code===1&&(n.success("权限分配成功"),f.value=!1,await y(1,_.value))}catch(a){console.error("权限分配失败:",a),n.error("权限分配失败，请重试")}},oe={children:"children",label:"name"},ie=(a,e,d)=>{console.log("节点:",a.id," 勾选状态:",e," 半选状态:",d),console.log("当前已选权限:",M.value)},se=a=>{D.value=a.map(e=>e.id)},ne=o(),de=async()=>{if(D.value.length===0){n.warning("请选择要删除的角色");return}try{await Te.confirm(`确定要删除选中的${D.value.length}个角色吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),E.value=!0;const a=D.value.join(",");({code:1,msg:"sucess",data:null}).code===1&&(n.success("批量删除成功"),D.value=[],await y(1,_.value))}catch(a){a!=="cancel"&&(console.error("批量删除角色失败:",a),n.error("批量删除失败，请重试"))}finally{E.value=!1}};return(a,e)=>{const d=m("el-input"),N=m("el-form-item"),s=m("el-button"),A=m("el-form"),L=m("el-card"),v=m("el-table-column"),ue=m("el-popconfirm"),ce=m("el-table"),me=m("el-pagination"),pe=m("el-dialog"),_e=m("el-drawer");return z(),Me("div",Ee,[t(L,null,{default:l(()=>[t(A,{inline:!0,class:"form",onSubmit:e[1]||(e[1]=ve(()=>{},["prevent"]))},{default:l(()=>[t(N,{label:"角色ID"},{default:l(()=>[t(d,{placeholder:"请输入角色ID",modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=r=>T.value=r),loading:I.value,onKeyup:ge(O,["enter"])},null,8,["modelValue","loading"])]),_:1}),t(N,null,{default:l(()=>[t(s,{type:"primary",size:"default",onClick:O,disabled:!T.value.trim(),loading:I.value,icon:"Search"},{default:l(()=>[...e[11]||(e[11]=[p("搜索",-1)])]),_:1},8,["disabled","loading"]),t(s,{type:"primary",size:"default",onClick:F,loading:I.value,icon:"Refresh"},{default:l(()=>[...e[12]||(e[12]=[p("重置",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),t(L,{style:{"margin-top":"10px"}},{default:l(()=>[k("div",Ie,[t(s,{type:"primary",size:"default",icon:"Plus",onClick:J},{default:l(()=>[...e[13]||(e[13]=[p("添加角色",-1)])]),_:1}),t(s,{type:"danger",size:"default",icon:"Delete",onClick:de},{default:l(()=>[...e[14]||(e[14]=[p("批量删除",-1)])]),_:1})]),k("div",De,[t(ce,{border:"",style:{margin:"10px"},data:w.value,loading:E.value,onSelectionChange:se,ref_key:"tableRef",ref:ne,width:"100%",fit:""},{default:l(()=>[t(v,{type:"selection",align:"center",width:"55",fixed:"left"}),t(v,{type:"index",align:"center",label:"#",fixed:"left"}),t(v,{label:"角色名称",align:"center","show-overflow-tooltip":"",prop:"roleName"}),t(v,{label:"创建人",align:"center","show-overflow-tooltip":"",prop:"createBy"}),t(v,{label:"创建时间",align:"center","show-overflow-tooltip":"",prop:"createTime"}),t(v,{label:"更新人",align:"center","show-overflow-tooltip":"",prop:"updateBy"}),t(v,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"updateTime"}),t(v,{label:"操作",width:"300",align:"center",fixed:"right"},{default:l(({row:r})=>[t(s,{type:"success",size:"small",plain:"",icon:"User",onClick:K=>ae(r)},{default:l(()=>[...e[15]||(e[15]=[p("分配权限",-1)])]),_:1},8,["onClick"]),t(s,{type:"primary",size:"small",plain:"",icon:"Edit",onClick:K=>Q(r)},{default:l(()=>[...e[16]||(e[16]=[p("编辑",-1)])]),_:1},8,["onClick"]),t(ue,{title:`你确定要删除${r.roleName}?`,width:"260px",onConfirm:K=>Z(r.id)},{reference:l(()=>[t(s,{type:"danger",plain:"",size:"small",icon:"Delete"},{default:l(()=>[...e[17]||(e[17]=[p("删除",-1)])]),_:1})]),_:1},8,["title","onConfirm"])]),_:1})]),_:1},8,["data","loading"])]),t(me,{"current-page":g.value,"onUpdate:currentPage":e[2]||(e[2]=r=>g.value=r),"page-size":_.value,"onUpdate:pageSize":e[3]||(e[3]=r=>_.value=r),"page-sizes":[10,20,30,40],background:!0,layout:" prev, pager, next, jumper,->,sizes,total",total:x.value,onSizeChange:G,onCurrentChange:q},null,8,["current-page","page-size","total"])]),_:1}),t(pe,{modelValue:u(c),"onUpdate:modelValue":e[8]||(e[8]=r=>C(c)?c.value=r:c=r),title:u(i).id?"更新角色":"添加角色",width:"30%"},{footer:l(()=>[t(s,{type:"primary",size:"default",onClick:e[7]||(e[7]=r=>C(c)?c.value=!1:c=!1)},{default:l(()=>[...e[18]||(e[18]=[p("取消",-1)])]),_:1}),t(s,{type:"primary",size:"default",onClick:X,disabled:!u(i).roleName.trim()},{default:l(()=>[...e[19]||(e[19]=[p("确定",-1)])]),_:1},8,["disabled"])]),default:l(()=>[t(A,{model:u(i),ref_key:"form",ref:P,rules:H,"label-width":"80px"},{default:l(()=>[u(i).id?(z(),j(N,{key:0,label:"ID"},{default:l(()=>[t(d,{placeholder:"角色ID",modelValue:u(i).id,"onUpdate:modelValue":e[4]||(e[4]=r=>u(i).id=r),disabled:""},null,8,["modelValue"])]),_:1})):$("",!0),t(N,{label:"角色名称",prop:"roleName"},{default:l(()=>[t(d,{placeholder:"请输入角色名称",modelValue:u(i).roleName,"onUpdate:modelValue":e[5]||(e[5]=r=>u(i).roleName=r),onInput:W},null,8,["modelValue"])]),_:1}),u(i).id?(z(),j(N,{key:1,label:"更新人"},{default:l(()=>[t(d,{placeholder:"更新人",modelValue:u(i).createPeople,"onUpdate:modelValue":e[6]||(e[6]=r=>u(i).createPeople=r)},null,8,["modelValue"])]),_:1})):$("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(_e,{modelValue:u(f),"onUpdate:modelValue":e[10]||(e[10]=r=>C(f)?f.value=r:f=r),onOpen:le},{header:l(()=>[...e[20]||(e[20]=[k("h4",null,"分配菜单与按钮的权限",-1)])]),default:l(()=>[t(u(Ne),{ref_key:"tree",ref:h,"show-checkbox":"","node-key":"id","default-expand-all":"",data:U.value,props:oe,"checked-keys":M.value,"check-strictly":"",onCheckChange:ie},null,8,["data","checked-keys"])]),footer:l(()=>[k("div",Pe,[t(s,{onClick:e[9]||(e[9]=r=>C(f)?f.value=!1:f=!1)},{default:l(()=>[...e[21]||(e[21]=[p("取消",-1)])]),_:1}),t(s,{type:"primary",onClick:re},{default:l(()=>[...e[22]||(e[22]=[p("确定",-1)])]),_:1})])]),_:1},8,["modelValue"])])}}}),he=Re(Be,[["__scopeId","data-v-cd6ca49a"]]);export{he as default};
