import{h as re,D as j,r as c,ag as A,G as ue,O as ce,c as J,f as t,a as s,s as L,w as i,p as a,H as pe,$ as g,S as q,M as me,k as G,ah as ve,ai as fe,a2 as K,B as p,o as D,g as v,aj as y,b as ge,t as u,U as ye,ab as Te,a6 as _e,a7 as T,a8 as h,ak as k,j as we,z as Q,_ as Se}from"./index-G-qDTFo-.js";const Ee={class:"action-container"},be={class:"card-wrapper"},Ue={class:"button-section"},Ce={class:"table-wrapper"},Ve={class:"pagination-section"},De={class:"dialog-footer"},he={key:0,class:"detail-container"},ke={class:"detail-row"},ze={class:"detail-value"},Ne={class:"detail-row"},xe={class:"detail-value"},Ae={class:"detail-row"},Me={class:"detail-value"},Pe={class:"detail-row"},Be={class:"detail-value"},Ye={class:"detail-row"},Re={class:"detail-value"},He={class:"detail-row"},Ie={class:"detail-value"},$e={class:"detail-row"},Oe={class:"detail-value"},Fe={class:"detail-row"},je={class:"detail-value"},Je={class:"detail-row"},Le={class:"detail-value"},qe={class:"detail-row"},Ge={class:"detail-value"},Ke={class:"detail-row"},Qe={class:"detail-value"},We={class:"detail-row"},Xe={class:"detail-value"},Ze={class:"detail-row"},et={class:"detail-value"},tt={class:"dialog-footer"},at=re({__name:"index",setup(lt){const f=j({currentPage:1,pageSize:10,total:0}),E=c([]),_=c(!1),b=c([]),U=c(null),w=async()=>{_.value=!0;try{const l={code:1,msg:"sucess",data:{total:22,records:[{id:"ACTION_001",actionName:"红色观影活动",activityContent:"观看《觉醒年代》并交流心得",signUpEndTime:null,actionStartTime:"2025-12-10 14:00:00",actionEndTime:"2025-12-10 16:30:00",eventAddress:"学校礼堂",state:1},{id:"ACTION_002",actionName:"志愿者活动",activityContent:"社区服务，关爱孤寡老人",signUpEndTime:null,actionStartTime:"2025-11-07 08:30:00",actionEndTime:"2025-12-07 12:30:00",eventAddress:"朝阳社区",state:2},{id:"ACTION_003",actionName:"党史知识竞赛",activityContent:"组织党员参加党史知识竞赛",signUpEndTime:null,actionStartTime:"2025-11-05 14:00:00",actionEndTime:"2025-11-05 16:30:00",eventAddress:"会议室",state:3}]}};l.code===1&&(E.value=l.data.records,f.total=l.data.total,M())}catch(l){console.error("获取活动列表失败",l)}finally{_.value=!1}},M=()=>{const l=new Date;E.value.forEach(e=>{const d=new Date(e.actionStartTime),m=new Date(e.actionEndTime);e.state===1&&l>=d&&P(e.id,2),e.state===2&&l>=m&&P(e.id,3)})},P=async(l,e)=>{try{if({code:0,msg:"状态更新成功",data:"success"}.code===0){const m=E.value.find(n=>n.id===l);m&&(m.state=e),p.success(`活动状态已更新为: ${W(e)}`)}}catch(d){p.error("状态更新失败，请稍后重试"),console.error("状态更新失败",d)}},W=l=>({1:"未开始",2:"进行中",3:"已结束"})[l]||"未知状态",X=()=>{U.value=window.setInterval(()=>{M()},6e4)},Z=()=>{U.value&&(clearInterval(U.value),U.value=null)},ee=l=>{b.value=l},B=async l=>{try{const e={code:1,msg:"删除成功"};e.code===1&&(p.success(e.msg),w())}catch{p.error("删除失败，请稍后重试")}},te=async()=>{if(b.value.length===0){p.warning("请先选择要删除的活动");return}try{await Q.confirm(`确定要删除选中的${b.value.length}个活动吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=b.value.map(e=>e.id);await B(l)}catch{}},ae=async l=>{try{await Q.confirm("确定要删除该活动吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await B(l.id)}catch{}},le=l=>{f.currentPage=l,w()},se=l=>{f.pageSize=l,f.currentPage=1,w()},Y=l=>({1:"未开始",2:"进行中",3:"已结束"})[l.state]||"未知状态",o=j({actionName:"",activityContent:"",organizerPhone:"",signUpStartTime:"",signUpEndTime:"",actionStartTime:"",actionEndTime:"",eventAddress:""}),z=c(A(o)),S=c(!1),R=c("添加活动"),C=c("add"),H=c(""),N=c(),V=c(!1),x=c(!1),r=c(null),I=async(l,e=!0)=>{x.value=!0;try{const d={code:1,msg:"sucess",data:{actionName:"红色观影活动",activityContent:"观看《觉醒年代》并交流心得",organizerPhone:"13654321711",signUpStartTime:"2023-10-01 09:00:00",signUpEndTime:"2023-10-04 17:00:00",actionStartTime:"2023-10-05 14:00:00",actionEndTime:"2023-10-05 16:30:00",eventAddress:"学校礼堂",createBy:"USER_003",createTime:"2025-05-25 17:19:00",updateBy:"USER_003",updateTime:"2025-09-12 13:08:16",isDelete:2,userList:["1","USER_001","USER_002","USER_003","USER_004","USER_005","USER_003"],state:1}};if(d.code===1){const m=d.data;return e&&(r.value=m,V.value=!0),m}}catch(d){return p.error("获取详情失败，请稍后重试"),console.error("获取活动详情失败",d),null}finally{x.value=!1}},oe=()=>{V.value=!1,r.value=null},$=async(l="add",e)=>{if(C.value=l,R.value=l==="add"?"添加活动":"编辑活动",N.value&&N.value.clearValidate(),l==="add")Object.keys(o).forEach(d=>{d!=="id"&&(o[d]="")}),delete o.id,z.value=A(o),S.value=!0;else if(e){_.value=!0;try{const d=await I(e.id,!1);d&&(H.value=e.id,o.id=e.id,o.actionName=d.actionName,o.activityContent=d.activityContent,o.organizerPhone=d.organizerPhone,o.signUpStartTime=d.signUpStartTime,o.signUpEndTime=d.signUpEndTime,o.actionStartTime=d.actionStartTime,o.actionEndTime=d.actionEndTime,o.eventAddress=d.eventAddress,z.value=A(o),S.value=!0)}finally{_.value=!1}}},O=()=>{S.value=!1},ne=()=>{const l=[{key:"actionName",name:"活动名称"},{key:"organizerPhone",name:"组织者电话"},{key:"signUpStartTime",name:"活动报名开始时间"},{key:"signUpEndTime",name:"活动报名结束时间"},{key:"actionStartTime",name:"活动开始时间"},{key:"actionEndTime",name:"活动结束时间"},{key:"eventAddress",name:"活动地点"}];for(const e of l)if(!o[e.key])return p.warning(`${e.name}不能为空`),!1;return!0},ie=()=>JSON.stringify(o)!==JSON.stringify(z.value),de=async()=>{if(ne()){if(C.value==="edit"&&!ie()){p.warning("未做任何修改，无需提交");return}_.value=!0;try{let l;if(C.value==="add")l={code:0,msg:"添加成功",data:""};else{const e={...o,id:H.value};l={code:0,msg:"修改成功",data:""}}l.code===0?(p.success(C.value==="add"?"添加成功":"修改成功"),O(),w()):p.error(l.msg||"操作失败")}catch{p.error("操作失败，请稍后重试")}finally{_.value=!1}}};return ue(()=>{w(),X()}),ce(()=>{Z()}),(l,e)=>{const d=ge("el-tag"),m=me("loading");return D(),J("div",Ee,[t("div",be,[t("div",Ue,[s(a(g),{type:"primary",icon:a(pe),onClick:e[0]||(e[0]=n=>$("add"))},{default:i(()=>[...e[13]||(e[13]=[v("添加活动",-1)])]),_:1},8,["icon"]),s(a(g),{type:"danger",icon:a(q),onClick:te},{default:i(()=>[...e[14]||(e[14]=[v("批量删除",-1)])]),_:1},8,["icon"])]),t("div",Ce,[L((D(),G(a(ve),{data:E.value,style:{width:"100%"},onSelectionChange:ee,stripe:"",border:"",fit:""},{default:i(()=>[s(a(y),{type:"selection",width:"55",fixed:"left"}),s(a(y),{prop:"actionName",label:"活动名称",fixed:"left","show-overflow-tooltip":""}),s(a(y),{prop:"activityContent",label:"活动内容","show-overflow-tooltip":""}),s(a(y),{prop:"actionStartTime",label:"开始时间","show-overflow-tooltip":""}),s(a(y),{prop:"actionEndTime",label:"结束时间","show-overflow-tooltip":""}),s(a(y),{prop:"eventAddress",label:"活动地点","show-overflow-tooltip":""}),s(a(y),{prop:"state",label:"状态","show-overflow-tooltip":""},{default:i(({row:n})=>[s(d,{type:n.state===1?"primary":n.state===2?"success":"warning"},{default:i(()=>[v(u(Y(n)),1)]),_:2},1032,["type"])]),_:1}),s(a(y),{label:"操作",width:"270",fixed:"right","show-overflow-tooltip":""},{default:i(({row:n})=>[s(a(g),{size:"small",type:"primary",plain:"",icon:a(ye),onClick:F=>I(n.id)},{default:i(()=>[...e[15]||(e[15]=[v("详情",-1)])]),_:1},8,["icon","onClick"]),s(a(g),{size:"small",type:"success",plain:"",icon:a(Te),onClick:F=>$("edit",n)},{default:i(()=>[...e[16]||(e[16]=[v("编辑",-1)])]),_:1},8,["icon","onClick"]),s(a(g),{size:"small",type:"danger",plain:"",icon:a(q),onClick:F=>ae(n)},{default:i(()=>[...e[17]||(e[17]=[v("删除",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[m,_.value]])]),t("div",Ve,[s(a(fe),{"current-page":f.currentPage,"onUpdate:currentPage":e[1]||(e[1]=n=>f.currentPage=n),"page-size":f.pageSize,"onUpdate:pageSize":e[2]||(e[2]=n=>f.pageSize=n),"page-sizes":[10,20,50,100],layout:"prev, pager, next, jumper,->,sizes, total",background:!0,total:f.total,onSizeChange:se,onCurrentChange:le},null,8,["current-page","page-size","total"])])]),s(a(K),{modelValue:S.value,"onUpdate:modelValue":e[11]||(e[11]=n=>S.value=n),title:R.value,width:"800px"},{footer:i(()=>[t("span",De,[s(a(g),{onClick:O},{default:i(()=>[...e[18]||(e[18]=[v("取消",-1)])]),_:1}),s(a(g),{type:"primary",onClick:de},{default:i(()=>[...e[19]||(e[19]=[v("确定",-1)])]),_:1})])]),default:i(()=>[s(a(_e),{model:o,ref_key:"formRef",ref:N,"label-width":"120px"},{default:i(()=>[s(a(T),{label:"活动名称",prop:"actionName"},{default:i(()=>[s(a(h),{modelValue:o.actionName,"onUpdate:modelValue":e[3]||(e[3]=n=>o.actionName=n),placeholder:"请输入活动名称"},null,8,["modelValue"])]),_:1}),s(a(T),{label:"活动内容",prop:"activityContent"},{default:i(()=>[s(a(h),{modelValue:o.activityContent,"onUpdate:modelValue":e[4]||(e[4]=n=>o.activityContent=n),placeholder:"请输入活动内容",type:"textarea",rows:4},null,8,["modelValue"])]),_:1}),s(a(T),{label:"组织者电话",prop:"organizerPhone"},{default:i(()=>[s(a(h),{modelValue:o.organizerPhone,"onUpdate:modelValue":e[5]||(e[5]=n=>o.organizerPhone=n),placeholder:"请输入组织者电话"},null,8,["modelValue"])]),_:1}),s(a(T),{label:"报名开始时间",prop:"signUpStartTime"},{default:i(()=>[s(a(k),{modelValue:o.signUpStartTime,"onUpdate:modelValue":e[6]||(e[6]=n=>o.signUpStartTime=n),type:"datetime",placeholder:"请选择报名开始时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),s(a(T),{label:"报名结束时间",prop:"signUpEndTime"},{default:i(()=>[s(a(k),{modelValue:o.signUpEndTime,"onUpdate:modelValue":e[7]||(e[7]=n=>o.signUpEndTime=n),type:"datetime",placeholder:"请选择报名结束时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),s(a(T),{label:"活动开始时间",prop:"actionStartTime"},{default:i(()=>[s(a(k),{modelValue:o.actionStartTime,"onUpdate:modelValue":e[8]||(e[8]=n=>o.actionStartTime=n),type:"datetime",placeholder:"请选择活动开始时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),s(a(T),{label:"活动结束时间",prop:"actionEndTime"},{default:i(()=>[s(a(k),{modelValue:o.actionEndTime,"onUpdate:modelValue":e[9]||(e[9]=n=>o.actionEndTime=n),type:"datetime",placeholder:"请选择活动结束时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),s(a(T),{label:"活动地点",prop:"eventAddress"},{default:i(()=>[s(a(h),{modelValue:o.eventAddress,"onUpdate:modelValue":e[10]||(e[10]=n=>o.eventAddress=n),placeholder:"请输入活动地点"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),L((D(),G(a(K),{modelValue:V.value,"onUpdate:modelValue":e[12]||(e[12]=n=>V.value=n),title:"活动详情",width:"800px"},{footer:i(()=>[t("span",tt,[s(a(g),{onClick:oe},{default:i(()=>[...e[33]||(e[33]=[v("关闭",-1)])]),_:1})])]),default:i(()=>[r.value?(D(),J("div",he,[t("div",ke,[e[20]||(e[20]=t("span",{class:"detail-label"},"活动名称：",-1)),t("span",ze,u(r.value.actionName),1)]),t("div",Ne,[e[21]||(e[21]=t("span",{class:"detail-label"},"活动内容：",-1)),t("span",xe,u(r.value.activityContent),1)]),t("div",Ae,[e[22]||(e[22]=t("span",{class:"detail-label"},"组织者电话：",-1)),t("span",Me,u(r.value.organizerPhone),1)]),t("div",Pe,[e[23]||(e[23]=t("span",{class:"detail-label"},"报名开始时间：",-1)),t("span",Be,u(r.value.signUpStartTime),1)]),t("div",Ye,[e[24]||(e[24]=t("span",{class:"detail-label"},"报名结束时间：",-1)),t("span",Re,u(r.value.signUpEndTime),1)]),t("div",He,[e[25]||(e[25]=t("span",{class:"detail-label"},"活动开始时间：",-1)),t("span",Ie,u(r.value.actionStartTime),1)]),t("div",$e,[e[26]||(e[26]=t("span",{class:"detail-label"},"活动结束时间：",-1)),t("span",Oe,u(r.value.actionEndTime),1)]),t("div",Fe,[e[27]||(e[27]=t("span",{class:"detail-label"},"活动地点：",-1)),t("span",je,u(r.value.eventAddress),1)]),t("div",Je,[e[28]||(e[28]=t("span",{class:"detail-label"},"创建人：",-1)),t("span",Le,u(r.value.createBy),1)]),t("div",qe,[e[29]||(e[29]=t("span",{class:"detail-label"},"创建时间：",-1)),t("span",Ge,u(r.value.createTime),1)]),t("div",Ke,[e[30]||(e[30]=t("span",{class:"detail-label"},"更新人：",-1)),t("span",Qe,u(r.value.updateBy),1)]),t("div",We,[e[31]||(e[31]=t("span",{class:"detail-label"},"更新时间：",-1)),t("span",Xe,u(r.value.updateTime),1)]),t("div",Ze,[e[32]||(e[32]=t("span",{class:"detail-label"},"活动状态：",-1)),t("span",et,[s(d,{type:r.value.state===1?"primary":r.value.state===2?"success":"warning"},{default:i(()=>[v(u(Y({state:r.value.state})),1)]),_:1},8,["type"])])])])):we("",!0)]),_:1},8,["modelValue"])),[[m,x.value]])])}}}),ot=Se(at,[["__scopeId","data-v-db15b9e2"]]);export{ot as default};
